<app-header></app-header>

<div class="sales-history-container">
  <button class="back-btn" (click)="goBack()">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å</button>

  <h2 class="page-title">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</h2>

  <!-- ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢ -->
  <div class="seller-info search-pagination flex-wrap gap-3">
    <div class="col">
      ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
      <input type="text" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ ‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢ ..." [(ngModel)]="criteriaModel.keySearch"
        (input)="filterSales()" />
    </div>
    <!-- <div class="col">
      ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
      <select name="" id="" [(ngModel)]="criteriaModel.status" (change)="readSale()">
        <option value="" selected>‡∏ó‡∏∏‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</option>
        <option value="A" selected>‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß</option>
        <option value="N" selected>‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</option>
      </select>
    </div> -->
    <div class="col">
      ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô
      <input type="date" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î..." [(ngModel)]="criteriaModel.startDate"
        (input)="filterSales()" />
    </div>
    <div class="col">
      ‡∏ñ‡∏∂‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
      <input type="date" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î..." [(ngModel)]="criteriaModel.endDate"
        (input)="filterSales()" />
    </div>
  </div>


  <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢ -->
  <div class="table-wrapper">
    <div class="head-table flex-wrap gap-3">
      <div class="col"><span class="title">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span></div>
      <div class="col d-flex justify-content-end w-fit gap-3">
        <button class="save-btn" (click)="goToLicenseRegister()">
          ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠
        </button>

      </div>

    </div>
    <div class="table-container">

      <table class="sales-table">
        <thead>
          <tr>
            <th>‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
            <th>‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</th>
            <th>‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢</th>
            <th>‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£</th>
            <th>‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°</th>
            <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
            <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</th>
            <th>‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</th>
          </tr>
        </thead>
        <tbody>
          @for (sale of paginatedSales; track $index) {
          <tr>
            <td>{{ (currentSalePage - 1) * totalSalePages + $index + 1 }}</td>

            <td>{{ sale.orderId }}</td>
            <td>{{ sale.sellerCode }}</td>
            <td>{{ sale.companyName }}</td>
            <td>{{ sale.program }}</td>
            <td><div [ngClass]="sale.orderStatus == 'A' ? 'd-success' : 'd-warning'" class="d-status">{{ sale.orderStatus == 'A' ?
              '‡∏°‡∏µ License' : '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ License' }}</div></td> 
            <td>{{ sale.createDate | date: 'dd/MM/yyyy' }}</td>
            <td>
              <div class="action-buttons">
                <button class="detail-btn" (click)="openDrawer(sale)">
                  <i class="fa fa-eye"></i>
                  <span>‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</span>
                </button>

                <button class="print-btn" (click)="printPO(sale)">
                  <i class="fa fa-print"></i>
                  <span>‡∏û‡∏¥‡∏°‡∏û‡πå</span>
                </button>
              </div>

            </td>
          </tr>
          }

        </tbody>
      </table>
    </div>
    <div class="pagination">
      <button (click)="prevSalePage()" [disabled]="currentSalePage === 1">‚Äπ</button>
      <span>‡∏´‡∏ô‡πâ‡∏≤ {{ currentSalePage }} / {{ totalSalePages }}</span>
      <button (click)="nextSalePage()" [disabled]="currentSalePage === totalSalePages">‚Ä∫</button>
    </div>
  </div>

  <!-- Drawer Overlay -->
  @if (isDrawer) {
  <div class="drawer-overlay" (click)="closeDrawer()" [class.fade-out]="isClosing"></div>
  }
  <!-- Drawer Panel (Full Screen) -->

  @if (isDrawer) {
  <div class="drawer-full" [class.slide-out]="isClosing">
    <div class="drawer-header">
      <h3>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î ‡∏ú‡∏π‡πâ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</h3>
      <button class="close-btn" (click)="closeDrawer()">√ó</button>
    </div>

    <div class="drawer-content">
      <div class="drawer-inner">
        <h4 class="org-name">
        </h4>
        <div class="drawer-table-wrapper">
          <div class="gen-license-container">
            <h2 class="page-title">üßæ ‡∏™‡∏£‡πâ‡∏≤‡∏á License Key</h2>
            <!-- ‡∏Å‡∏£‡∏≠‡∏ö‡∏ö‡∏ô: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢ / ‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£ -->
            <div class="summary-box">
              <div class="summary-row">
                <div><strong>‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢:</strong> {{ model.sellerCode }}</div>
                <div><strong>‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°:</strong> {{ model.program }}</div>
              </div>
              <div class="summary-row">
                <div><strong>‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£:</strong> {{ model.companyName }}</div>
                <div><strong>‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏û‡πä‡∏Ñ‡πÄ‡∏Å‡∏à:</strong> {{model.package}}</div>

              </div>
              <div class="summary-row">
                <div><strong>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô License:</strong> {{ model.licenseCount }}</div>
                <div><strong>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢:</strong> {{ model.price | number }} ‡∏ö‡∏≤‡∏ó</div>
              </div>

              <!-- <div class="summary-row">
                <div>
                  <strong>‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÅ‡∏ô‡∏ö:</strong>
                  <a [hidden]="model.fileUrl" [href]="model.fileUrl" target="_blank" class="doc-link">‡∏î‡∏π‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</a>
                </div>

              </div> -->
            </div>

            <!-- ‡∏Å‡∏£‡∏≠‡∏ö‡∏•‡πà‡∏≤‡∏á: License List -->
            <div class="license-card">
              <div class="header" style="display: flex;justify-content: space-between;">
                <h3>üîë ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ License ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á</h3>
                <button class="btn-generate" *ngIf="listLicensKey.length == 0" (click)="generateLicensesbutton()">‡∏™‡∏£‡πâ‡∏≤‡∏á
                  License</button>
              </div>

              <table class="license-table" *ngIf="listLicensKey.length > 0">
                <thead>
                  <tr>
                    <th>‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
                    <th>License Key</th>
                    <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                    <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á</th>
                    <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let lic of listLicensKey; let i = index">
                    <td>{{ i + 1 }}</td>
                    <td class="license-key">{{ lic.licenseKey }}</td>
                    <td>
                      <span [class.active]="lic.status === 'A'" [class.pending]="lic.status === 'N'">
                        {{ lic.status === 'A' ? 'Active ‡πÅ‡∏•‡πâ‡∏ß' : '‡∏£‡∏≠ Activate' }}
                      </span>
                    </td>
                    <td>{{ lic.createDate | date: 'dd/MM/yyyy' }}</td>
                    <td>
                      <button class="btn-action" (click)="copyLicense(lic.key)">üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å</button>
                    </td>
                  </tr>
                </tbody>
              </table>

              <div class="empty-state" *ngIf="listLicensKey.length === 0">
                <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ License ‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á</p>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>
  }
</div>

@if (showSuccessPopup) {
<div class="popup-overlay">
  <div class="popup-card">
    <div class="popup-icon">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
      </svg>
    </div>
    <h2>{{popupSuccessTitle}}</h2>
    <div class="btn-c">
      <button class="popup-btn" (click)="closePopup()">‡∏ï‡∏Å‡∏•‡∏á</button>
    </div>
  </div>
</div>
}

@if (showErrorPopup) {
<div class="popup-overlay">
  <div class="popup-card error-card">
    <div class="popup-icon-error error-icon">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </div>
    <h2>‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</h2>
    <p>{{ popupErrorMessage }}</p>
    <div class="btn-c">
      <button class="popup-btn error-btn" (click)="closeErrorPopup()">‡∏õ‡∏¥‡∏î</button>
    </div>
  </div>
</div>
}

@if (isShowDeletePopup) {
<div class="popup-overlay">
  <div class="popup-card error-card">
    <div class="popup-icon-error error-icon">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </div>
    <h2>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</h2>
    <p>‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà</p>
    <div class="btn-c d-flex gap-3">
      <button class="popup-btn secound" (click)="closeDeletePopup()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
      <button class="popup-btn " (click)="deleteItem()">‡∏ï‡∏Å‡∏•‡∏á</button>
    </div>
  </div>
</div>
}

<app-footer></app-footer>