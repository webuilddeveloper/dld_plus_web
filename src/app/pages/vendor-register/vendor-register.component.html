<!-- <app-sidebar></app-sidebar> -->
<app-header></app-header>

<section class="vendor-register" data-aos="fade-up">
  <h1 class="title">ลงทะเบียนผู้ขาย (Vendor Register)</h1>
  <p class="subtitle">กรอกข้อมูลหน่วยงาน/บริษัท เพื่อเริ่มต้นเป็นผู้ขายในระบบ</p>

  <form [formGroup]="form" (ngSubmit)="submit()" novalidate class="form-card">

    <!-- ประเภทผู้ขาย -->
    <div class="field-row">
      <label>ประเภทผู้ขาย <span class="req">*</span></label>
      <div class="radio-group">
        <label><input type="radio" formControlName="sellerType" value="company"> นิติบุคคล</label>
        <label><input type="radio" formControlName="sellerType" value="person"> บุคคลธรรมดา</label>
      </div>
    </div>

    <div class="grid">
      <div class="field" *ngIf="form.get('sellerType')?.value === 'company'">
        <label>ชื่อบริษัท/หน่วยงาน <span class="req">*</span></label>
        <input type="text" formControlName="companyName" placeholder="เช่น บริษัท โมด โซลูชันส์ จำกัด">
        <small class="err" *ngIf="form.get('companyName')?.touched && form.get('companyName')?.invalid">
          กรุณากรอกชื่อบริษัท/หน่วยงาน
        </small>
      </div>

      <div class="field">
        <label>เลขประจำตัวผู้เสียภาษี (13 หลัก) <span class="req">*</span></label>
        <input type="text" formControlName="taxId" maxlength="13" placeholder="xxxxxxxxxxxxx"
          (input)="onNumericInput($event, 'taxId')">
        <div *ngIf="form.get('taxId')?.invalid && (form.get('taxId')?.touched || form.get('taxId')?.dirty)">
          <small class="err" *ngIf="form.get('taxId')?.hasError('required')">
            กรุณากรอกเลขประจำตัวผู้เสียภาษี
          </small>
          <small class="err" *ngIf="form.get('taxId')?.hasError('pattern')">
            กรุณากรอกเป็นตัวเลขเท่านั้น
          </small>
          <small class="err" *ngIf="form.get('taxId')?.hasError('minlength')">
            ต้องเป็นตัวเลข 13 หลัก
          </small>
          <small class="err" *ngIf="form.get('taxId')?.hasError('invalidThaiId')">
            เลขประจำตัวผู้เสียภาษีไม่ถูกต้อง
          </small>
        </div>
      </div>
    </div>

    <div class="grid">
      <div class="field">
        <label>ผู้ติดต่อ <span class="req">*</span></label>
        <input type="text" formControlName="contactName" placeholder="ชื่อ-สกุล ผู้ติดต่อ">
        <small class="err" *ngIf="form.get('contactName')?.touched && form.get('contactName')?.invalid">
          กรุณากรอกชื่อผู้ติดต่อ
        </small>
      </div>

      <div class="field">
        <label>อีเมล <span class="req">*</span></label>
        <input type="email" formControlName="email" placeholder="name@example.com">
        <small class="err" *ngIf="form.get('email')?.touched && form.get('email')?.invalid">
          อีเมลไม่ถูกต้อง
        </small>
      </div>

      <div class="field">
        <label>เบอร์โทรศัพท์ <span class="req">*</span></label>
        <input type="text" formControlName="phone" placeholder="0812345678" (input)="onNumericInput($event, 'phone')">
        <small class="err" *ngIf="form.get('phone')?.touched && form.get('phone')?.invalid">
          เบอร์โทรไม่ถูกต้อง
        </small>
      </div>
    </div>

    <div class="field">
      <label>ที่อยู่ (สำหรับติดต่อ/ออกเอกสาร) <span class="req">*</span></label>
      <input type="text" formControlName="addressLine" placeholder="เลขที่ ถนน ตรอก/ซอย อาคาร">
      <small class="err" *ngIf="form.get('addressLine')?.touched && form.get('addressLine')?.invalid">
        กรุณากรอกที่อยู่
      </small>
    </div>

    <div class="grid">
      <div class="field">
        <label>จังหวัด</label>
        <select formControlName="province" (change)="onProvinceChange($event)">
          <option value="">-- เลือกจังหวัด --</option>
          <option *ngFor="let p of provinces" [value]="p.code">{{ p.title }}</option>
        </select>
      </div>

      <div class="field">
        <label>อำเภอ/เขต</label>
        <select formControlName="district" (change)="onDistrictChange($event)">
          <option value="">-- เลือกอำเภอ --</option>
          <option *ngFor="let d of districts" [value]="d.code">{{ d.title }}</option>
        </select>
      </div>

      <div class="field">
        <label>ตำบล/แขวง</label>
        <select formControlName="subdistrict" (change)="onSubdistrictChange($event)">
          <option value="">-- เลือกตำบล --</option>
          <option *ngFor="let s of subdistricts" [value]="s.code">{{ s.title }}</option>
        </select>
      </div>

      <div class="field">
        <label>รหัสไปรษณีย์</label>
        <input type="text" formControlName="postalCode" maxlength="5" readonly />
      </div>
    </div>


    <div class="grid">
      <div class="field">
        <label>เว็บไซต์</label>
        <input type="text" formControlName="website" placeholder="https://example.com">
      </div>
      <div class="field">
        <label for="bankName">ชื่อธนาคาร <span class="req">*</span></label>
        <select id="bankName" formControlName="bankName" required>
          <option value="" disabled>-- กรุณาเลือกธนาคาร --</option>
          <option *ngFor="let bank of banks" [value]="bank.name">
            {{ bank.name }}
          </option>
        </select>
        <small class="err" *ngIf="form.get('bankName')?.invalid && form.get('bankName')?.touched">
          กรุณาเลือกธนาคาร
        </small>
      </div>
      <div class="field">
        <label>ชื่อบัญชี</label>
        <input type="text" formControlName="bankAccountName" placeholder="ชื่อบัญชี">
      </div>
      <div class="field">
        <label>เลขที่บัญชี</label>
        <input type="text" formControlName="bankAccountNumber" placeholder="xxxxxxxxxx"
          (input)="onNumericInput($event, 'bankAccountNumber')">
      </div>
    </div>

    <hr>
    <h3>เอกสารแนบ</h3>
    <p class="form-description">
      อัปโหลดเอกสารเพื่อยืนยันตัวตน (รองรับเฉพาะไฟล์ .pdf, .jpg, .png ขนาดไม่เกิน 5MB)
    </p>

    <div class="field">
      <label for="companyAffidavitFile">
        <span *ngIf="form.get('sellerType')?.value === 'company'">
          1. หนังสือรับรองบริษัท (ไม่เกิน 6 เดือน) <span class="req">*</span>
        </span>
        <span *ngIf="form.get('sellerType')?.value === 'person'">
          1. สำเนาบัตรประชาชน <span class="req">*</span>
        </span>
      </label>
      <input type="file" id="companyAffidavitFile" class="file-input" accept=".pdf,.jpg,.jpeg,.png"
        (change)="onFileSelect($event, 'companyAffidavitFile')">

      <span class="file-name" *ngIf="form.get('companyAffidavitFile')?.value">
        {{ form.get('companyAffidavitFile')?.value.name }}
      </span>
      <small class="err"
        *ngIf="form.get('companyAffidavitFile')?.hasError('required') && form.get('companyAffidavitFile')?.touched">
        <span *ngIf="form.get('sellerType')?.value === 'company'">กรุณาแนบหนังสือรับรองบริษัท</span>
        <span *ngIf="form.get('sellerType')?.value === 'person'">กรุณาแนบสำเนาบัตรประชาชน</span>
      </small>
    </div>

    <div class="consent">
      <label>
        <input type="checkbox" id="consent-checkbox" formControlName="consent">
        ข้าพเจ้ายินยอมให้บริษัท We-Lap จัดเก็บและใช้ข้อมูลส่วนบุคคล
        ตาม <a href="#" target="_blank">นโยบายความเป็นส่วนตัว (Privacy
          Policy)</a>
      </label>
    </div>
    <div *ngIf="form.get('consent')?.invalid && form.get('consent')?.touched">
      <small class="err">กรุณายอมรับข้อตกลงและเงื่อนไข</small>
    </div>
    <div class="btn-c">
      <button type="submit" class="submit-btn">
        ส่งใบสมัคร
      </button>
    </div>
  </form>
</section>

<div class="popup-overlay" *ngIf="showSuccessPopup">
  <div class="popup-card">
    <div class="popup-icon">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
      </svg>
    </div>
    <h2>บันทึกข้อมูลสำเร็จ</h2>
    <p>เราได้รับข้อมูลการลงทะเบียนของท่านแล้ว<br>เจ้าหน้าที่จะติดต่อกลับไปโดยเร็วที่สุด</p>
    <div class="btn-c">
      <button class="popup-btn" type="button" (click)="closePopup()">ตกลง</button>
    </div>
  </div>
</div>

<div class="popup-overlay" *ngIf="showErrorPopup">
  <div class="popup-card error-card">
    <div class="popup-icon error-icon">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </div>
    <h2>เกิดข้อผิดพลาด</h2>
    <p>{{ popupErrorMessage }}</p>
    <div class="btn-c">
      <button class="popup-btn error-btn" type="button" (click)="closeErrorPopup()">ปิด</button>
    </div>
  </div>
</div>

<app-footer></app-footer>
